function t(t,e){const n=t.match(new RegExp(`.*(?=${e})`));return null===n?"":n.join("")}function e(t,e){const n=t.match(new RegExp(`[^${e}]+$`));return null===n?"":n[0]}function n(t){const e=t.match(/\d+(?!.*\d)/g);return null===e?"":e[0]}function i(t){console.warn("Can’t parse the file sequence correctly, returning [].\nReason: "+t)}
/**
 * Sequencer - A fast(?) fullscreen image-sequence player.
 * See README or visit github (link below) for details.
 * @copyright 2012-21
 * @version 3.0.1
 * @author Andreas Gysin
 *         https://ertdfgcvb.xyz
 *         https://github.com/ertdfgcvb/Sequencer
 */const o=[];var s=null;const c={hasTouch:!1};class a{constructor(o){if(this.config={canvas:null,list:[],from:"",to:"",step:1,scaleMode:"cover",direction:"x",playMode:"drag",loop:"loop",interval:0,autoLoad:"all",fitFirstImage:!1,showLoadedImages:!1,dragAmount:10,hiDPI:!0,smoothing:!0,...o},""==this.config.from&&""==this.config.to&&0==this.config.list.length)return console.error("Missing filenames."),!1;if(null===this.config.canvas){const t=document.createElement("canvas");document.body.appendChild(t),this.config.canvas=t,this.config.fitFirstImage=!0}this.pointer={x:0,y:0,down:!1},this.current=-1,this.images=[],this.directionSign=/-/.test(this.config.direction)?-1:1,this.lastLoaded=-1,this.pongSign=1,this.ctx=this.config.canvas.getContext("2d"),this.list=this.config.list.length>0?this.config.list:function(o,s,c=1){const a=[],h=n(o);if(""===h)return i("the first filename doesn’t contain a number."),a;const r=n(s);if(""===r)return i("the last filename doesn’t contain a number."),a;const g=t(o,h),l=e(o,h);if(g!==t(s,r)||l!==e(s,r))return i("the base-names of '"+o+"' and '"+s+"' don’t match."),a;if((0==h.charAt(0)||0==r.charAt(0))&&h.length!=r.length)return i("wrong number of leading zeros."),a;const f=parseInt(h),u=parseInt(r);for(let t=f;t<=u;t+=c)a.push(g+(t+"").padStart(h.length,"0")+l);return a}(this.config.from,this.config.to,this.config.step),this.size(this.ctx.canvas.width,this.ctx.canvas.height),"first"==this.config.autoLoad?new p(this.images,[this.list.shift()],h.bind(null,this)):"all"==this.config.autoLoad&&this.load()}load(){this.load=function(){console.log("load() can be called only once.")},new p(this.images,this.list,h.bind(null,this),r.bind(null,this))}run(){const t=c.hasTouch?"touchmove":"mousemove",e=c.hasTouch?"touchstart":"mousedown",n=c.hasTouch?"touchend":"mouseup";if(this.config.scrollMarker&&s.addEventListener("scroll",m.bind(null,this)),"hover"===this.config.playMode)this.config.hoverElement?this.config.hoverElement.addEventListener(t,d.bind(null,this)):this.ctx.canvas.addEventListener(t,d.bind(null,this));else if("drag"===this.config.playMode)this.ctx.canvas.addEventListener(t,f.bind(null,this)),this.ctx.canvas.addEventListener(e,g.bind(null,this)),document.addEventListener(n,l.bind(null,this));else if("auto"===this.config.playMode){let t=0;const e=n=>{const i=n-t;i>=this.config.interval&&(this.nextImage(),t=Math.max(n,n-(i-this.config.interval))),requestAnimationFrame(e)};requestAnimationFrame(e)}}nextImage(t){t||(t=this.config.loop),"pong"===t?(this.current+=this.pongSign,this.current>=this.images.length-1?(this.pongSign=-1,this.current=this.images.length-1):this.current<=0&&(this.pongSign=1,this.current=0),this.drawImage(this.current)):this.drawImage(++this.current%this.images.length)}drawImage(t){if(void 0===t&&(t=this.current),t<0||t>=this.images.length)return;const e=this.config.hiDPI?s.devicePixelRatio:1,n=this.ctx.canvas.width/e,i=this.ctx.canvas.height/e,o=n/i,c=this.images[t],a=c.width/c.height;let h,r;"cover"==this.config.scaleMode?o>a?(h=n,r=h/a):(r=i,h=r*a):"contain"==this.config.scaleMode?o<a?(h=n,r=h/a):(r=i,h=r*a):(h=c.width,r=c.height);const g=n/2-h/2,l=i/2-r/2;this.ctx.save(),this.ctx.scale(e,e),this.ctx.clearRect(0,0,n,i),this.ctx.imageSmoothingEnabled=this.config.smoothing,this.ctx.drawImage(c,0,0,c.width,c.height,Math.floor(g),Math.floor(l),Math.ceil(h),Math.ceil(r)),this.ctx.restore()}size(t,e){const n=this.config.hiDPI?s.devicePixelRatio:1,i=this.ctx.canvas;i.width=t*n,i.height=e*n,i.style.width=t+"px",i.style.height=e+"px",this.drawImage()}}function h(t,e){e.id>t.lastLoaded&&t.config.showLoadedImages&&(t.drawImage(e.id),t.lastLoaded=e.id),"function"==typeof t.config.imageLoad&&(e.sequencer=t,t.config.imageLoad(e)),"function"==typeof t.imageLoad&&(e.sequencer=t,t.imageLoad(e)),0===e.id&&(t.config.fitFirstImage&&(t.size(e.img.width,e.img.height),t.config.fitFirstImage=!1),t.drawImage(0),t.current=0)}function r(t,e){"function"==typeof t.config.queueComplete&&(e.sequencer=t,t.config.queueComplete(e)),"function"==typeof t.queueComplete&&t.queueComplete(e),t.run(),t.config.showLoadedImages||"none"===t.config.playMode||t.drawImage(0)}function g(t,e){let n,i;e.touches?(n=e.touches[0].pageX-e.touches[0].target.offsetLeft,i=e.touches[0].pageY-e.touches[0].target.offsetTop):(n=e.offsetX,i=e.offsetY),t.pointer={x:n,y:i,down:!0,currentId:t.current}}function l(t,e){t.pointer.down=!1}function f(t,e){if(!t.pointer.down)return;const n=t.images.length;let i,o;e.touches?(i=e.touches[0].pageX-e.touches[0].target.offsetLeft,o=e.touches[0].pageY-e.touches[0].target.offsetTop):(i=e.offsetX,o=e.offsetY);let s=0;/x/.test(t.config.direction)?s=(i-t.pointer.x)*t.directionSign:/y/.test(t.config.direction)&&(s=(o-t.pointer.y)*t.directionSign);let c=t.pointer.currentId+Math.floor(s/t.config.dragAmount);c<0?c=n- -c%n:c>n&&(c%=n),c!=t.current&&(t.drawImage(c),t.current=c),e.preventDefault()}function u(t,e,n){return t<e?e:t>n?n:t}function d(t,e){const n=t.images.length,i=t.config.hiDPI?s.devicePixelRatio:1;let o,c,a,h;e.touches?(o=e.touches[0].pageX-e.touches[0].target.offsetLeft,c=e.touches[0].pageY-e.touches[0].target.offsetTop):(o=e.offsetX,c=e.offsetY),"x"==t.config.direction?(h=t.ctx.canvas.width/i,a=o):"-x"==t.config.direction?(h=t.ctx.canvas.width/i,a=h-o-1):"y"==t.config.direction?(h=t.ctx.canvas.height/i,a=c):"-y"==t.config.direction&&(h=t.ctx.canvas.height/i,a=h-c-1);const r=u(Math.floor(a/h*n),0,n-1);r!=t.current&&(t.drawImage(r),t.current=r),e.preventDefault()}function m(t,e){const n=t.images.length,i=t.config.hiDPI?s.devicePixelRatio:1;let o=t.ctx.canvas.height/i,c=t.config.scrollMarker?t.config.scrollMarker.getBoundingClientRect().top:t.ctx.canvas.getBoundingClientRect().top;t.config.scrollOffset&&(c+=t.config.scrollOffset);const a=u(Math.floor(c/o*n),0,n-1);a!=t.current&&(t.drawImage(a),t.current=a),e.preventDefault()}function p(t,e,n,i){const o=Math.min(e.length,4);let s=t.length-1,c=t.length;for(let t=0;t<o;t++)a();function a(){if(s>=e.length-1)return;s++;const o=new Image;var h;o.src=e[s],h=s,o.onload=t=>{"function"==typeof n&&n({id:h,img:o,count:++c,total:e.length}),c<e.length&&a(),c==e.length&&"function"==typeof i&&i({total:e.length})},o.onerror=t=>{console.error("Error with: "+e[h])},t.push(o)}}var v={make:function(t,e){s=e,c.hasTouch="ontouchstart"in e||navigator.msMaxTouchPoints;const n=new a(t);return!1!==n&&o.push(n),n},instances:o};export{v as default};
